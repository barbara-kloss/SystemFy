<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutricional</title>
    <link rel="stylesheet" href="telaNutricionalAdmin.css">
    <link href="https://fonts.googleapis.com/css2?family=Alata&family=Akshar:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <div class="background">
        <div class="bolinha bolinha1"></div>
        <div class="bolinha bolinha2"></div>
        <div class="bolinha bolinha3"></div>
        <div class="bolinha bolinha4"></div>
        <div class="bolinha bolinha5"></div>
        <div class="bolinha bolinha6"></div>

        <div class="logoCantoInferior">
            <img src="../../imgFy/logoSemfundoEscritaBranca.png" alt="Logo">
        </div>

        <div class="logoWhatsApp">
            <img src="../../imgFy/whatsapp (3).png" alt="logoWhatsApp">
        </div>

        <div class="fundoSemiTransparente">

            <div class="main-content-grid">

                <div class="navBar">
                    <nav>
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a href="telaInicialAdmin.html">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="" class="active">Nutricional</a>
                            </li>
                            <li class="nav-item">
                                <a href="telaPersonal.html">Treinos</a>
                            </li>
                            <li class="nav-item">
                                <a href="telaNewCliente.html">Clientes</a>
                            </li>
                            <li class="nav-item">
                                <a href="telaRelatorios.html">Relatorios</a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <div class="top-right-bar">

                    <div class="search-bar search-cliente">
                        <input type="text" placeholder="Cliente" class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>

                    <div class="profile-box-container">

                        <a href="telaPerfilAdmin.html" class="profile-link">
                            <div class="cardVerPerfil"> <i class="fas fa-user"></i> </div>
                            <div class="textocardVerPerfil"> Ver perfil </div>
                        </a>

                    </div>
                </div>

                <div class="content-cards-wrapper">

                    <div class="card-edicao-refeicao">

                        <h3 class="cliente-nome">(Cadastrando Nova Refeição)</h3>

                        <form class="refeicao-form">

                            <div class="input-group-grid-row">

                                <div class="input-group half-width-field">
                                    <label for="tipoRefeicao">Tipo de Refeição</label>
                                    <select id="tipoRefeicao">
                                        <option value="Geral" selected>Refeições Geral</option>
                                        <option value="Livre">Refeições Livre</option>
                                    </select>
                                </div>

                                <div class="input-group half-width-field">
                                    <label for="horario">Horário</label>
                                    <input type="time" id="horario" value="08:00">
                                </div>
                            </div>
                            <div class="input-group">
                                <label for="categoriaNome">Nome da Refeição</label>
                                <input type="text" id="categoriaNome" value="">
                            </div>

                            <div class="input-group">
                                <label for="observacao">Observação</label>
                                <textarea id="observacao"></textarea>
                            </div>
                        </form>

                        <button type="submit" class="btn-confirmar">Confirmar</button>
                    </div>

                    <div class="card-lista-refeicoes">

                        <div class="lista-header">
                            <h3 class="lista-titulo">Refeições</h3>

                            <select id="filtroRefeicao" class="filtro-refeicao-select">
                                <!-- <option value="todos">Todos</option> -->
                                <option value="Geral">Refeições Geral</option>
                                <option value="Livre">Refeições Livre</option>
                            </select>
                        </div>

                        <div class="lista-itens-scroll">
                            <div class="refeicao-item clickable-item" data-id="1" data-tipo="Geral">
                                <span class="refeicao-horario">6:00</span>
                                <span class="refeicao-nome">Ao acordar</span>
                                <button class="btn-excluir"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="refeicao-item clickable-item" data-id="2" data-tipo="Geral">
                                <span class="refeicao-horario">7:00</span>
                                <span class="refeicao-nome">Café da Manhã</span>
                                <button class="btn-excluir"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="refeicao-item clickable-item" data-id="3" data-id="3" data-tipo="Livre">
                                <span class="refeicao-horario">8:00</span>
                                <span class="refeicao-nome">Lanche da Manhã</span>
                                <button class="btn-excluir"><i class="fas fa-times"></i></button>
                            </div>
                        </div>

                        <button class="btn-adicionar-refeicao" title="Adicionar Nova Refeição">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {

        const listaItensScroll = document.querySelector('.lista-itens-scroll');
        const filtroRefeicao = document.getElementById('filtroRefeicao'); // Novo seletor

        // --- FUNÇÃO DE FILTRAGEM ---
        function applyFilter(filterValue) {
            const itens = document.querySelectorAll('.refeicao-item');
            
            itens.forEach(item => {
                const tipo = item.getAttribute('data-tipo');
                
                if (filterValue === 'todos' || tipo === filterValue) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // --- FUNÇÃO PARA ADICIONAR EVENT LISTENERS (USADA NA CRIAÇÃO E CARREGAMENTO INICIAL) ---
        function attachEventListeners(itemElement) {
            // 1. Exclusão
            itemElement.querySelector('.btn-excluir').addEventListener('click', function (e) {
                e.stopPropagation();
                const nomeRefeicao = itemElement.querySelector('.refeicao-nome').textContent.trim();
                const confirmExclusao = confirm(`Tem certeza que deseja excluir a refeição "${nomeRefeicao}"?`);
                if (confirmExclusao) {
                    itemElement.remove();
                    alert('Refeição excluída com sucesso! (Ação simulada)');
                }
            });

            // 2. Edição
            itemElement.addEventListener('click', function () {
                const nome = this.querySelector('.refeicao-nome').textContent.trim();
                const horaString = this.querySelector('.refeicao-horario').textContent.trim();
                const tipo = this.getAttribute('data-tipo'); // Captura o tipo para edição
                const hora = horaString.padStart(5, '0');

                document.getElementById('categoriaNome').value = nome;
                document.getElementById('horario').value = hora;
                document.getElementById('tipoRefeicao').value = tipo; // Define o tipo no formulário
                document.querySelector('.cliente-nome').textContent = `(Editando: ${nome})`;
            });
        }

        // Anexar listeners aos itens existentes ao carregar
        document.querySelectorAll('.refeicao-item.clickable-item').forEach(attachEventListeners);
        
        // --- EVENTO DO FILTRO ---
        filtroRefeicao.addEventListener('change', function() {
            applyFilter(this.value);
        });


        // --- AÇÃO DE CONFIRMAR (Edição/Criação) ---
        const confirmButton = document.querySelector('.btn-confirmar');
        const refeicaoForm = document.querySelector('.refeicao-form');

        confirmButton.addEventListener('click', function (e) {
            e.preventDefault();

            const horario = document.getElementById('horario').value;
            const nomeRefeicao = document.getElementById('categoriaNome').value;
            const tipoRefeicao = document.getElementById('tipoRefeicao').value; // Captura o tipo
            
            const isCreating = document.querySelector('.cliente-nome').textContent.includes('Cadastrando');

            let message;

            if (isCreating) {
                // === AÇÃO CRÍTICA: INSERIR O NOVO ITEM NA LISTA ===
                
                const novoItem = document.createElement('div');
                const novoId = listaItensScroll.children.length + 1;

                novoItem.className = 'refeicao-item clickable-item';
                novoItem.setAttribute('data-id', novoId);
                novoItem.setAttribute('data-tipo', tipoRefeicao); // **CRÍTICO: Adiciona o atributo para o filtro**

                novoItem.innerHTML = `
                    <span class="refeicao-horario">${horario}</span>
                    <span class="refeicao-nome">${nomeRefeicao}</span>
                    <button class="btn-excluir"><i class="fas fa-times"></i></button>
                `;

                listaItensScroll.prepend(novoItem); 
                attachEventListeners(novoItem); 
                
                // Aplica o filtro atual ao novo item
                if (filtroRefeicao.value !== 'todos' && filtroRefeicao.value !== tipoRefeicao) {
                     novoItem.style.display = 'none';
                }

                message = `Refeição '${nomeRefeicao}' cadastrada com sucesso!`;

                // Limpa e volta ao padrão
                refeicaoForm.reset();
                document.getElementById('horario').value = '08:00';
                document.getElementById('tipoRefeicao').value = 'Geral';
                document.getElementById('categoriaNome').value = '';
                document.getElementById('observacao').value = '';
                document.querySelector('.cliente-nome').textContent = '(Nome do Cliente)';

            } else {
                // Lógica de Edição (Você precisaria encontrar o ID e atualizar o item da lista)
                message = `Refeição de ${nomeRefeicao} (${horario}) editada com sucesso!`;
            }

            alert('Ação registrada: ' + message);
        });

        // --- Funcionalidade do Botão Adicionar (+) ---
        document.querySelector('.btn-adicionar-refeicao').addEventListener('click', function () {
            const form = document.querySelector('.refeicao-form');
            form.reset();
            document.getElementById('horario').value = '08:00';
            document.getElementById('tipoRefeicao').value = 'Geral';
            document.getElementById('categoriaNome').value = '';
            document.getElementById('observacao').value = '';
            document.querySelector('.cliente-nome').textContent = '(Cadastrando Nova Refeição)';
            alert('Pronto para cadastrar uma nova refeição!');
        });
    });
</script>
</body>

</html>